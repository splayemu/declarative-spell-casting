<!DOCTYPE html>
<html>
	<head>	
		<title>Spell Casting Fun</title>

		<script type="text/javascript" src="jquery-1.9.1.min.js"></script>
		<!--<script type="text/javascript" src="http://cdn.craftycomponents.com/crafty-release.js"></script>-->
		<script type="text/javascript" src="crafty.js"></script>
		<script type="text/javascript" src="interpreter.js"></script>
		<script type="text/javascript" src="game.js"></script>
		<script type="text/javascript" src="spells.js"></script>
		<link rel="stylesheet" type="text/css" href="style.css">
		<script type="text/javascript">
			jQuery(document).ready(function(){
				listPlayerSpellNames();
				var spell_tab = "player_spells_tab";
				
				$("#submit_btn").click(function() {  
					var spell_name 		= $("input#spell_name").val();
					var spell_text 		= $("textarea#spell_text").val();
					var spell_params 	= $("textarea#spell_params").val();
					//alert("Spell text: " + spell_text);
					insertPlayerSpell(spell_name, spell_params, spell_text);
					listPlayerSpellNames();
					return false; 
				});  
				
				$(document).on("click", ".spell_name", (function() {  
					var clicked_spell_name = $(this).text();
					$("input#spell_name").val(clicked_spell_name);
					grabSpellText(clicked_spell_name);
					grabSpellParams(clicked_spell_name);
					//alert(clicked_element);
					return false; 
				}));
				
				$(".tab").on('click', (function() {  
					var clicked_spell_type = $(this).attr('id');

					if (clicked_spell_type != spell_tab && clicked_spell_type == "player_spells_tab") {
						listPlayerSpellNames();
					}
					else if (clicked_spell_type != spell_tab && clicked_spell_type == "library_spells_tab") {
						listLibrarySpellNames();					
					}
					spell_tab = clicked_spell_type;
					//alert(clicked_spell_type);				
					return false; 
				}));
				
			});
 
			var listPlayerSpellNames = function () {
				/*
				$("#spell_name_lister").html('<ul>');
				for(var spell_name in player_spells) {
					//log("Spell name: " + spell_name);
					$("#spell_name_lister").append('<li id=spell_' + spell_name + ' class=spell_name>' + spell_name + '</li>');
				}
				$("#spell_name_lister").append('</ul>');
				*/
				$("#spell_name_lister").html('');				
				// create an empty array for building up the html output
				var html = [];

				// create a table
				html.push('<ul>');

				for(var spell_name in player_spells) {
					// do some sanity checking
					if (null != spell_name) {
						// add a row to the table
						html.push('<li id=spell_' + spell_name + ' class=spell_name>' + spell_name + '</li>');
					}
				}

				// close the table
				html.push('</ul>');

				// find the results div in the DOM and set its HTML content
				document.getElementById("spell_name_lister").innerHTML = html.join("");
				
			}
			var listLibrarySpellNames = function () {	
				$("#spell_name_lister").html('');	
			
				// create an empty array for building up the html output
				var html = [];

				// create a table
				html.push('<ul>');

				for(var spell_name in library_spells) {
					// do some sanity checking
					if (null != spell_name) {
						// add a row to the table
						html.push('<li id=spell_' + spell_name + ' class=spell_name>' + spell_name + '</li>');
					}
				}

				// close the table
				html.push('</ul>');

				// find the results div in the DOM and set its HTML content
				document.getElementById("spell_name_lister").innerHTML = html.join("");
				
			}			
			
			
			var grabSpellText = function (spell_name) {
				// save code currently in textarea#spell_text
				var spell = player_spells[spell_name];
				if(spell == undefined) {
					alert("Error: " + spell_name + " is not a spell");
					return false;
				}
				var spell_text = spell['spell_text'];
				$("textarea#spell_text").val(spell_text);
			}
			
			var grabSpellParams = function (spell_name) {
				// save code currently in textarea#spell_text
				var spell = player_spells[spell_name];
				if(spell == undefined) {
					alert("Error: " + spell_name + " is not a spell");
					return false;
				}
				var spell_params = spell['params'];
				$("textarea#spell_params").val(spell_params);
			}
 
		</script>
	</head>
	<body>
		<h1>Spell Casting Fun</h1>
		<div id="main_horizontal_column">
			<div id="main_game_box">
				<div id="game_location">
					<div id="cr-stage"></div>
				</div>
			</div>
			<div id="spell_library_box">
				<div id="spell_name_area">
					<div id="spell_name_centered_area">
						<div id="spells_tab_area">
						<div id="player_spells_tab" class="tab">  <b> Current Spells </b> </div>
						<div id="library_spells_tab" class="tab"> <b> Library Spells </b> </div>
						</div>
						<div id="spell_name_lister"> </div>
						<div id="new_spell_name">
							<b> Enter Spell Name Here </b>
							<input type="text" id="spell_name" name="spell_name" />
							<input type="submit" name="submit" class="button" id="submit_btn" value="Add or Update Spell" />
							<p> You may edit a spell by clicking one of your current spells, and changing the spell text. 
								You may also create a new spell by entering a new spell name and text. Press 'Add or Update Spell' when done editing.</p>
						</div>
					</div>
				</div>
				<div id="spell_display_area">
					<div id="params_display_area">
						<b> Enter Spell Parameters Here </b>
						<textarea id="spell_params"/>Enter Spell Parameters Here</textarea>
					</div>
					<div id="spell_display_centered_area">
						<b> Enter Spell Text Here </b>
						<textarea id="spell_text"/>Enter Spell Text Here</textarea>
					</div>
				</div>
				<!--<div id="spell_casting_area">
					<div id="spell_to_cast_area"></div>
					<div id="spell_to_casts_arguments_area">
						<textarea id="spell_arguments"/>Enter Spell Text Here</textarea>
					</div>
				</div> -->
			</div>
		</div>
	</body>
</html>
